{% extends 'base.html' %}
{% block title %}ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡{% endblock %}
{% block content %}
<h1 class="mb-4">
  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="me-2" viewBox="0 0 16 16" style="vertical-align: middle;">
    <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
  </svg>
  ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Performance Report)
</h1>

<div class="card mb-4">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
            <th>Ù…Ø¯Ø§Ø®ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</th>
            <th>Ù…ØµØ±ÙˆÙØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</th>
            <th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ù‡Ù€Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)</th>
            <th>Ø³ÙŠØ§Ø±Ø§Øª Ù…ØºÙ„ÙØ© (Ù‡Ù€Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)</th>
            <th>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒÙ„Ù Ø¨Ù‡Ø§</th>
            <th>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</th>
            <th>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th>
          </tr>
        </thead>
        <tbody>
        {% for item in report_data %}
          <tr>
            <td>{{ loop.index }}</td>
            <td><strong>{{ item.agent.name }}</strong></td>
            <td>
              <span class="badge bg-success" style="font-size: 0.9rem;">
                {{ "%.2f"|format(item.month_income) }} Ø¯Ø±Ù‡Ù…
              </span>
            </td>
            <td>
              <span class="badge bg-danger" style="font-size: 0.9rem;">
                {{ "%.2f"|format(item.month_expenses) }} Ø¯Ø±Ù‡Ù…
              </span>
            </td>
            <td>
              <span class="badge bg-{% if item.net_profit_month >= 0 %}info{% else %}warning{% endif %}" style="font-size: 0.9rem;">
                {{ "%.2f"|format(item.net_profit_month) }} Ø¯Ø±Ù‡Ù…
              </span>
            </td>
            <td>
              <span class="badge bg-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M4 11a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm8 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM3 5.5A1.5 1.5 0 0 1 4.5 4h7A1.5 1.5 0 0 1 13 5.5v5a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 10.5v-5zM4.5 5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-7z"/>
                </svg>
                {{ item.cars_this_month }} Ø³ÙŠØ§Ø±Ø©
              </span>
            </td>
            <td>{{ item.tasks_assigned }}</td>
            <td>{{ item.tasks_completed }}</td>
            <td>
              {% if item.tasks_assigned > 0 %}
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar {% if (item.tasks_completed / item.tasks_assigned * 100) >= 80 %}bg-success{% elif (item.tasks_completed / item.tasks_assigned * 100) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                       role="progressbar" 
                       style="width: {{ (item.tasks_completed / item.tasks_assigned * 100)|round }}%">
                    {{ (item.tasks_completed / item.tasks_assigned * 100)|round }}%
                  </div>
                </div>
              {% else %}
                <span class="text-muted">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4 mb-3">
    <div class="card border-success">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0">ğŸ† Ø§Ù„Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡Ù‹ (Ù‡Ù€Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)</h6>
      </div>
      <div class="card-body text-center">
        {% if report_data %}
          <h3 class="text-success">{{ report_data[0].agent.name }}</h3>
          <p class="mb-1"><strong>Ù…Ø¯Ø§Ø®ÙŠÙ„:</strong> {{ "%.2f"|format(report_data[0].month_income) }} Ø¯Ø±Ù‡Ù…</p>
          <p class="mb-1"><strong>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</strong> {{ "%.2f"|format(report_data[0].net_profit_month) }} Ø¯Ø±Ù‡Ù…</p>
          <p class="mb-0"><strong>Ø³ÙŠØ§Ø±Ø§Øª Ù…ØºÙ„ÙØ©:</strong> {{ report_data[0].cars_this_month }}</p>
        {% else %}
          <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="col-md-4 mb-3">
    <div class="card border-info">
      <div class="card-header bg-info text-white">
        <h6 class="mb-0">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚</h6>
      </div>
      <div class="card-body text-center">
        {% if report_data %}
          {% set total_month_income = report_data|sum(attribute='month_income') %}
          {% set total_month_expenses = report_data|sum(attribute='month_expenses') %}
          {% set total_net_profit = total_month_income - total_month_expenses %}
          <h3 class="text-info">{{ "%.2f"|format(total_net_profit) }} Ø¯Ø±Ù‡Ù…</h3>
          <p class="mb-1"><small>Ù…Ø¯Ø§Ø®ÙŠÙ„: {{ "%.2f"|format(total_month_income) }} Ø¯Ø±Ù‡Ù…</small></p>
          <p class="mb-0"><small>Ù…ØµØ±ÙˆÙØ§Øª: {{ "%.2f"|format(total_month_expenses) }} Ø¯Ø±Ù‡Ù…</small></p>
        {% else %}
          <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="col-md-4 mb-3">
    <div class="card border-primary">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0">ğŸš— Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h6>
      </div>
      <div class="card-body text-center">
        {% if report_data %}
          {% set total_cars_month = report_data|sum(attribute='cars_this_month') %}
          <h3 class="text-primary">{{ total_cars_month }}</h3>
          <p class="mb-0"><small>Ø³ÙŠØ§Ø±Ø© Ù…ØºÙ„ÙØ© Ù‡Ù€Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</small></p>
        {% else %}
          <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="mt-3">
  <a href="/admin" class="btn btn-secondary">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
    </svg>
    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
  </a>
</div>

{% endblock %}
