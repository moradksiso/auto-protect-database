{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1 class="mb-4">Admin Dashboard</h1>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card bg-primary text-white">
      <div class="card-body">
        <h6 class="card-title">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</h6>
        <h2>{{ "%.2f"|format(stats.total_purchases) }} Ø¯.Ù…</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-success text-white">
      <div class="card-body">
        <h6 class="card-title">Ø§Ù„Ù…Ø¯Ø§Ø®ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</h6>
        <h2>{{ "%.2f"|format(stats.total_income) }} Ø¯.Ù…</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card {% if stats.profit >= 0 %}bg-info{% else %}bg-danger{% endif %} text-white">
      <div class="card-body">
        <h6 class="card-title">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ</h6>
        <h2>{{ "%.2f"|format(stats.profit) }} Ø¯.Ù…</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-warning text-dark">
      <div class="card-body">
        <h6 class="card-title">Ø§Ù„Ù…Ù‡Ø§Ù…</h6>
        <h2>{{ stats.open_tasks }} <small>/ {{ stats.overdue_tasks }} Ù…ØªØ£Ø®Ø±Ø©</small></h2>
      </div>
    </div>
  </div>
</div>

<!-- Quick Info -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="alert alert-info">
      <strong>ğŸ“Š Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©:</strong> 
      Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†: <strong>{{ stats.agents_count }}</strong> |
      {% if stats.top_agent %}
        Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø£ÙØ¶Ù„: <strong>{{ stats.top_agent.name }}</strong>
      {% else %}
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ø¹Ø¯
      {% endif %}
      | 
      <a href="/reports/performance" class="alert-link">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„</a>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0">Agents</h5>
      </div>
      <div class="card-body">
        <ul class="list-group">
        {% for a in agents[:5] %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ a.name }}
            <a class="btn btn-sm btn-outline-secondary" href="/agents/{{a.id}}/edit">Edit</a>
          </li>
        {% endfor %}
        </ul>
        <a class="btn btn-primary btn-sm mt-2" href="/agents/new">Create new agent</a>
        <a class="btn btn-secondary btn-sm mt-2" href="/agents">View all</a>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-header bg-success text-white">
        <h5 class="card-title mb-0">Uploaded Files</h5>
      </div>
      <div class="card-body">
        <ul class="list-group">
        {% for f in files %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ f.filename }}
            <a class="btn btn-sm btn-outline-success" href="/files/download/{{ f.id }}">Download</a>
          </li>
        {% endfor %}
        </ul>
        <a class="btn btn-success btn-sm mt-2" href="/files/upload">Upload XLS</a>
        <a class="btn btn-secondary btn-sm mt-2" href="/files/download_all">Download all (zip)</a>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header bg-warning text-dark">
        <h5 class="card-title mb-0">Recent Tasks</h5>
      </div>
      <div class="card-body">
        <ul class="list-group">
        {% for t in tasks %}
          <li class="list-group-item">
            <strong>{{ t.title }}</strong> - Agent {{ t.agent_id }} - Due {{ t.due_date }}
          </li>
        {% endfor %}
        </ul>
        <a class="btn btn-warning btn-sm mt-2" href="/tasks">View all tasks</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
